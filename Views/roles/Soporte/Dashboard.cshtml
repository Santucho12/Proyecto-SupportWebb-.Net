@model SupportWeb.Models.ViewModels.Soporte.SoporteDashboardViewModel
@{
    ViewData["Title"] = "Dashboard de Soporte";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container-fluid dashboard-soporte">
    <!-- Header del Dashboard de Soporte -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 text-primary fw-bold">
                        <i class="fas fa-headset me-2"></i>Dashboard de Soporte
                    </h1>
                    <p class="text-muted mb-0">Bienvenido/a</p>
                    <small class="text-muted">Panel de gestión para personal de soporte técnico</small>
                </div>
                <div class="text-end">
                    <button class="btn btn-outline-primary btn-sm" onclick="refreshSoporteDashboard()">
                        <i class="fas fa-sync-alt me-1"></i>Actualizar
                    </button>
                    <span class="badge bg-success ms-2">En línea</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Tarjetas de Estadísticas Principales -->
    <div class="row mb-4">
        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card stats-card bg-primary text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title mb-1">Total Reclamos</h5>
                            <h2 class="mb-0 fw-bold">@Model.TotalReclamos</h2>
                            <small class="opacity-75">Todos los casos</small>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-ticket-alt fa-2x opacity-75"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card stats-card stats-card-pendientes text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title mb-1">Pendientes</h5>
                            <h2 class="mb-0 fw-bold">
                                @{ var pendientesNuevos = Model.ReclamosRecientes.Count(r => r.Estado == "Nuevo"); }
                                @pendientesNuevos
                            </h2>
                            <small class="opacity-75">Casos sin responder</small>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-ticket-alt fa-2x opacity-75"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card stats-card" style="background-color: #ff9800; color: #fff;">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title mb-1">En Proceso</h5>
                                <h2 class="mb-0 fw-bold">@Model.ReclamosEnProceso</h2>
                            <small class="opacity-75">Siendo trabajados</small>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-cogs fa-2x opacity-75"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-3 col-sm-6 mb-3">
            <div class="card stats-card bg-success text-white">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="card-title mb-1">Resueltos</h5>
                            <h2 class="mb-0 fw-bold">@Model.ReclamosResueltos</h2>
                            <small class="opacity-75">Casos cerrados</small>
                        </div>
                        <div class="stats-icon">
                            <i class="fas fa-check-circle fa-2x opacity-75"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Métricas de Rendimiento -->
    <div class="row mb-4">
        <div class="col-md-4 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title text-dark">
                        <i class="fas fa-stopwatch me-2 text-primary"></i>Tiempo Promedio
                    </h5>
                    <div class="text-center">
                        <h3 class="text-primary fw-bold">2.3 días</h3>
                        <p class="text-muted mb-0">Resolución de casos</p>
                        <div class="progress mt-2" style="height: 8px;">
                            <div class="progress-bar bg-primary" style="width: 75%"></div>
                        </div>
                        <small class="text-success">
                            <i class="fas fa-arrow-down me-1"></i>-15% vs mes anterior
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title text-dark">
                        <i class="fas fa-smile me-2 text-success"></i>Satisfacción
                    </h5>
                    <div class="text-center">
                        <h3 class="text-success fw-bold">86%</h3>
                        <p class="text-muted mb-0">Clientes satisfechos</p>
                        <div class="progress mt-2" style="height: 8px;">
                            <div class="progress-bar bg-success" style="width: 92%"></div>
                        </div>
                        <small class="text-success">
                            <i class="fas fa-arrow-up me-1"></i>+5% vs mes anterior
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-3">
            <div class="card h-100">
                <div class="card-body">
                    <h5 class="card-title text-dark">
                        <i class="fas fa-exclamation-triangle me-2 text-danger"></i>Casos Urgentes
                    </h5>
                    <div class="text-center">
                        <h3 class="text-danger fw-bold">
                            @{ var urgentesSinCerrados = Model.ReclamosRecientes.Count(r => r.Prioridad == "Alta" && r.Estado != "Cerrado"); }
                            @urgentesSinCerrados
                        </h3>
                        <p class="text-muted mb-0">Prioridad alta</p>
                        <div class="d-grid gap-2 mt-3">
                            <a href="/Soporte/CasosUrgentes" class="btn btn-outline-danger btn-sm">
                                <i class="fas fa-eye me-1"></i>Ver casos urgentes
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- Tabla de Reclamos Recientes -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-list me-2"></i>Reclamos Recientes
                    </h5>
                    <a href="/Soporte/GestionReclamos" class="btn btn-outline-primary btn-sm">
                        <i class="fas fa-external-link-alt me-1"></i>Ver todos
                    </a>
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>ID</th>
                                    <th>Título</th>
                                    <th>Estado</th>
                                    <th>Prioridad</th>
                                    <!-- Usuario column removed -->
                                    <th></th>
                                    <th>Fecha</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.ReclamosRecientes.Any())
                                {
                                    @foreach (var reclamo in Model.ReclamosRecientes.Take(5))
                                    {
                                        <tr>
                                            <td>
                                                <span class="badge bg-light text-dark">
                                                    #@reclamo.Id.ToString().Substring(0, 8)
                                                </span>
                                            </td>
                                            <td>
                                                <div class="fw-semibold">@reclamo.Titulo</div>
                                                <small class="text-muted">@reclamo.Descripcion.Substring(0, Math.Min(50, reclamo.Descripcion.Length))...</small>
                                            </td>
                                            <td>
                                                @{
                                                        var estadoBadge = reclamo.Estado switch
                                                        {
                                                                "Nuevo" => "bg-primary",         // azul
                                                                "EnProceso" => "bg-warning",     // naranja
                                                                "Respondido" => "bg-light text-dark", // gris clarito
                                                                "Cerrado" => "bg-secondary",      // gris
                                                                _ => "bg-secondary"
                                                        };
                                                }
                                                <span class="badge @estadoBadge">@reclamo.Estado</span>
                                            </td>
                                            <td>
                                                @{
                                                        var prioridadBadge = reclamo.Prioridad switch
                                                        {
                                                            "Alta" => "bg-danger",           // rojo
                                                            "Urgente" => "bg-danger",        // rojo
                                                            "Media" => "bg-warning",         // naranja
                                                            "Baja" => "bg-secondary",        // gris
                                                            _ => "bg-secondary"
                                                        };
                                                }
                                                <span class="badge @prioridadBadge">@reclamo.Prioridad</span>
                                            </td>
                                            <td>
                                                <!-- Usuario column removed -->
                                            </td>
                                            <td>
                                                <small class="text-muted">@reclamo.FechaCreacion.ToString("dd/MM/yyyy HH:mm")</small>
                                            </td>
                                            <td>
                                                <div class="btn-group btn-group-sm">
                                                    <a href="/Soporte/DetalleReclamo/@reclamo.Id" class="btn btn-outline-secondary btn-sm" title="Ver detalles">
                                                        <i class="fas fa-eye"></i> Ver detalles
                                                    </a>
                                                    @if (reclamo.Estado == "Nuevo" || reclamo.Estado == "EnProceso")
                                                    {
                                                        <a href="/Soporte/NuevaRespuestaPorId/@reclamo.Id" class="btn btn-outline-danger btn-sm ms-1" title="Responder">
                                                            <i class="fas fa-reply"></i> Responder
                                                        </a>
                                                    }
                                                </div>
                                            </td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="7" class="text-center text-muted py-4">
                                            <i class="fas fa-inbox fa-2x mb-2"></i>
                                            <br>No hay reclamos recientes
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>


</div>

<!-- Estilos específicos para el dashboard de soporte -->
<style>
.dashboard-soporte {
    background-color: #f8f9fa;
    min-height: 100vh;
    padding: 2rem 0;
}

.stats-card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: transform 0.2s, box-shadow 0.2s;
}

.stats-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
}

.stats-icon {
    opacity: 0.8;
}

.card {
    border: none;
    border-radius: 15px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.table-hover tbody tr:hover {
    background-color: #f8f9fa;
}

.badge {
    font-size: 0.75rem;
}

.btn-group-sm > .btn, .btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.75rem;
    border-radius: 0.375rem;
}

/* Estilos mejorados para Tareas Rápidas de Soporte */
.tareas-soporte {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #6c5ce7 100%);
    border: none;
    border-radius: 25px;
    box-shadow: 0 15px 40px rgba(102, 126, 234, 0.3);
    overflow: hidden;
    position: relative;
    backdrop-filter: blur(20px);
}

.tareas-soporte::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
    pointer-events: none;
}

.tareas-soporte-header {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.2), rgba(255, 255, 255, 0.1));
    border-bottom: 1px solid rgba(255, 255, 255, 0.3);
    backdrop-filter: blur(15px);
    padding: 1.5rem;
    position: relative;
    z-index: 2;
}

.tareas-soporte-header .card-title {
    color: white;
    font-weight: 700;
    font-size: 1.3rem;
    text-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
    letter-spacing: 0.5px;
}

.tareas-soporte-header .fas {
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    animation: lightningGlow 2s ease-in-out infinite alternate;
}

@@keyframes lightningGlow {
    0% { filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3)) drop-shadow(0 0 8px rgba(255, 255, 255, 0.2)); }
    100% { filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3)) drop-shadow(0 0 15px rgba(255, 255, 255, 0.4)); }
}

.tareas-soporte-body {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.08), rgba(255, 255, 255, 0.03));
    padding: 2.5rem;
    position: relative;
    z-index: 2;
}

.tareas-btn {
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.25), rgba(255, 255, 255, 0.15));
    border: 2px solid rgba(255, 255, 255, 0.4);
    border-radius: 20px;
    color: white;
    padding: 2rem 1.5rem;
    transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    backdrop-filter: blur(15px);
    position: relative;
    overflow: hidden;
    min-height: 160px;
    display: flex;
    align-items: center;
    justify-content: center;
    text-decoration: none;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
}

.tareas-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    transition: left 0.8s ease;
}

.tareas-btn::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 70%);
    transition: all 0.6s ease;
    transform: translate(-50%, -50%);
    border-radius: 50%;
}

.tareas-btn:hover::before {
    left: 100%;
}

.tareas-btn:hover::after {
    width: 200px;
    height: 200px;
}

.tareas-btn:hover {
    transform: translateY(-12px) scale(1.05) rotateX(5deg);
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
    border-color: rgba(255, 255, 255, 0.8);
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0.25));
    color: white;
    text-decoration: none;
}

.tareas-btn:active {
    transform: translateY(-8px) scale(1.02);
    transition: all 0.2s ease;
}

.tareas-btn-content {
    text-align: center;
    z-index: 3;
    position: relative;
    transform-style: preserve-3d;
}

.tareas-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    display: block;
    filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
    transition: all 0.4s ease;
    animation: iconFloat 3s ease-in-out infinite;
}

@@keyframes iconFloat {
    0%, 100% { transform: translateY(0px) rotateY(0deg); }
    50% { transform: translateY(-8px) rotateY(10deg); }
}

.tareas-btn:hover .tareas-icon {
    transform: scale(1.2) rotateY(20deg);
    filter: drop-shadow(0 6px 12px rgba(0, 0, 0, 0.5)) drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
}

.tareas-text {
    font-size: 1.2rem;
    font-weight: 700;
    display: block;
    margin-bottom: 0.8rem;
    text-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);
    letter-spacing: 0.5px;
    transition: all 0.3s ease;
}

.tareas-btn:hover .tareas-text {
    transform: scale(1.1);
    text-shadow: 0 3px 8px rgba(0, 0, 0, 0.5);
}

.tareas-description {
    font-size: 0.9rem;
    opacity: 0.95;
    font-weight: 500;
    text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3);
    line-height: 1.4;
    transition: all 0.3s ease;
}

.tareas-btn:hover .tareas-description {
    opacity: 1;
    transform: translateY(-2px);
}

/* Estilos específicos para cada botón */
.tareas-btn-reclamos {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.3), rgba(118, 75, 162, 0.2));
    border-color: rgba(102, 126, 234, 0.5);
}

.tareas-btn-reclamos:hover {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.5), rgba(118, 75, 162, 0.4));
    border-color: rgba(102, 126, 234, 0.8);
    box-shadow: 0 20px 50px rgba(102, 126, 234, 0.4);
}

.tareas-btn-respuesta {
    background: linear-gradient(135deg, rgba(40, 167, 69, 0.3), rgba(25, 135, 84, 0.2));
    border-color: rgba(40, 167, 69, 0.5);
}

.tareas-btn-respuesta:hover {
    background: linear-gradient(135deg, rgba(40, 167, 69, 0.5), rgba(25, 135, 84, 0.4));
    border-color: rgba(40, 167, 69, 0.8);
    box-shadow: 0 20px 50px rgba(40, 167, 69, 0.4);
}

.tareas-btn-urgentes {
    background: linear-gradient(135deg, rgba(220, 53, 69, 0.3), rgba(176, 42, 55, 0.2));
    border-color: rgba(220, 53, 69, 0.5);
}

.tareas-btn-urgentes:hover {
    background: linear-gradient(135deg, rgba(220, 53, 69, 0.5), rgba(176, 42, 55, 0.4));
    border-color: rgba(220, 53, 69, 0.8);
    box-shadow: 0 20px 50px rgba(220, 53, 69, 0.4);
}

.tareas-btn-urgentes .tareas-icon {
    animation: iconFloat 2s ease-in-out infinite, urgentPulse 1.5s ease-in-out infinite;
}

@@keyframes urgentPulse {
    0%, 100% { filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4)); }
    50% { filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4)) drop-shadow(0 0 15px rgba(220, 53, 69, 0.6)); }
}

/* Animación de entrada para los botones */
.tareas-btn {
    animation: slideInUp 0.8s ease-out forwards;
    opacity: 0;
    transform: translateY(50px);
}

.tareas-btn:nth-child(1) { animation-delay: 0.1s; }
.tareas-btn:nth-child(2) { animation-delay: 0.2s; }
.tareas-btn:nth-child(3) { animation-delay: 0.3s; }

@@keyframes slideInUp {
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Responsive improvements */
@@media (max-width: 768px) {
    .tareas-soporte-body {
        padding: 1.5rem;
    }

    .tareas-btn {
        min-height: 140px;
        padding: 1.5rem 1rem;
    }

    .tareas-icon {
        font-size: 2.5rem;
    }

    .tareas-text {
        font-size: 1.1rem;
    }

    .tareas-description {
        font-size: 0.85rem;
    }
}

/* Clase específica para la tarjeta de Pendientes */
.stats-card-pendientes {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%) !important;
    border: 2px solid #dc3545 !important;
    box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3) !important;
}

.stats-card-pendientes:hover {
    background: linear-gradient(135deg, #c82333 0%, #a71e2a 100%) !important;
    box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4) !important;
    transform: translateY(-5px) !important;
}
</style>

<!-- Scripts para gráficos -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Gráfico de distribución por estado (datos ficticios)
const estadosCtx = document.getElementById('estadosChart').getContext('2d');
new Chart(estadosCtx, {
    type: 'doughnut',
    data: {
        labels: ['Nuevo', 'En Proceso', 'Respondido', 'Cerrado'],
        datasets: [{
            data: [12, 8, 5, 20],
            backgroundColor: ['#ffc107', '#17a2b8', '#007bff', '#28a745'],
            borderWidth: 2,
            borderColor: '#fff'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { position: 'bottom' } }
    }
});

// Gráfico de tendencia semanal (datos ficticios)
const tendenciaCtx = document.getElementById('tendenciaChart').getContext('2d');
new Chart(tendenciaCtx, {
    type: 'line',
    data: {
        labels: ['Lun', 'Mar', 'Mié', 'Jue', 'Vie', 'Sáb', 'Dom'],
        datasets: [{
            label: 'Reclamos por día',
            data: [5, 8, 6, 10, 7, 4, 9],
            borderColor: '#007bff',
            backgroundColor: 'rgba(0, 123, 255, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
    }
});

// Función para actualizar el dashboard
function refreshSoporteDashboard() {
    location.reload();
}

// Auto-refresh cada 5 minutos
setInterval(function() {
    if (document.visibilityState === 'visible') {
        refreshSoporteDashboard();
    }
}, 300000);
</script>
